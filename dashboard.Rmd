---
title: "video game stats"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
runtime: shiny
---

```{r setup, include=FALSE}

#install.packages("flexdashboard")
#install.packages("shiny")
#install.packages("datasets")
library(flexdashboard)
library(shiny)
library(datasets)
#data(faithful)
##
# Authors: Justin Hathaway, Jenkin Schibel, Anthony Moran
##

# Take in our csv file and create a dataframe
games <- read.csv("games.csv", header=TRUE)
data(games)
attach(games)
```

Column {.sidebar}
-----------------------------------------------------------------------

Global video game sales based on consoles based on ESRB rating

```{r}
selectInput("type", label = "global sales display selection",
            choices = c(names(games)), selected = "Rating")
selectInput("lm_1", label = "lhs of linear model", choices = c(names(games)), selected = "Rating")
selectInput("lm_2", label = "rhs of linear model", choices = c(names(games)), selected = "User_Score")

```

Row
-----------------------------------------------------------------------

###Global Video game sales and stuff

```{r}
renderPlot({
 plot(y=Global_Sales,x=eval(as.symbol(input$type)), main="Global Sales", col="blue",ylab="Number of copies sold (millions)", xlab=input$type)
  
  })
```

###Linear model 1

```{r}

renderPlot({
 plot(y=eval(as.symbol(input$lm_1)), x=eval(as.symbol(input$lm_2)), main="linear regression", col="blue",ylab=input$lm_1, xlab=input$lm_2)
  
 lm.fit = lm(eval(as.symbol((input$lm_1))) ~ eval(as.symbol((input$lm_2))))
 
 abline(lm.fit)
  })
```


###GLM model
```{r}
renderPlot({
     library(gbm)
     data = read.csv("test/Video_Games_Sales_as_at_22_Dec_2016.csv")
     colnames(data)
     clean = data
     clean.omit = na.omit(clean)
     clean.omit = clean.omit[!(clean.omit$NA_Sales > 12),]
     
     clean.omit$Developer = as.numeric(as.factor(clean.omit$Developer))
     
     clean.omit$User_Score = as.numeric(as.character(clean.omit$User_Score))
     
     sample <- sample.int(n = nrow(clean.omit), size = floor(.3*nrow(clean.omit)))
     train <- clean.omit[sample, ]
     test  <- clean.omit[-sample, ]
     
     boost.vg=gbm(NA_Sales ~ Genre + Platform + Developer + Publisher + User_Score + Critic_Score, data=clean.omit[-sample,], distribution="gaussian",n.trees=5000,interaction.depth=8)
     
     tree.pred=predict(boost.vg,newdata=clean.omit[sample,],n.trees=5000)
     head(tree.pred)
     head(clean.omit[sample,]$NA_Sales)
     summary(boost.vg)
   })
```